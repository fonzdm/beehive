apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: jellyfin
  namespace: servarr
spec:
  interval: 1h0m0s
  chart:
    spec:
      chart: jellyfin
      sourceRef:
        kind: HelmRepository
        name: truecharts
  values:
    workload:
      main:
        podSpec:
          containers:
            main:
              resources:
                limits:
                  cpu: 0 # unlimited
                  memory: 7Gi

    metrics:
      main:
        enabled: false
    ingress:
      jellyfin-ing:
        enabled: true
        primary: true
        required: true
        expandObjectName: false
        ingressClassName: tailscale
        annotations:
          tailscale.com/funnel: "true"
        hosts:
        - host: jellyfin
          paths:
          - path: /
            pathType: Prefix
        tls:
        - hosts:
          - jellyfin
        integrations:
          certManager:
            enabled: false
          traefik:
            enabled: false
    persistence:
      transcode:
        enabled: false
      config:
        enabled: true
        type: pvc
        size: 20Gi
        accessModes: ReadWriteMany
        storageClass: nas
        targetSelector:
          main:
            main:
              mountPath: /config
      media:
        enabled: true
        type: pvc
        existingClaim: talos-media-volume
        targetSelector:
          main:
            main:
              mountPath: /mnt/media

